<!DOCTYPE html>
<html>
  <head>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.2.21/angular.min.js'></script>
    <script src='http://code.jquery.com/jquery-2.1.0.min.js'></script>
    <script src='http://underscorejs.org/underscore-min.js'></script>
    <script src='example_controller.js'></script>
    <script src='json_func_directive.js'></script>
    <link href='http://getbootstrap.com/dist/css/bootstrap.min.css' rel='stylesheet'>
    <script>
      valid_functions = [{"name":"acres_to_sq_feet","description":"Looks up a field, reads the value as acres and converts to sqft","args":[{"name":"lookup_field","description":"A raw data field in acres","template":"lookup.html"}]},{"name":"address","description":"Look up an address based on a list of parts","args":[{"name":"list_lookup_address_parts","description":"A list of raw field address parts in order","template":"list_lookup.html"}]},{"name":"publicly_viewable","description":"Takes a raw field for status and a list of publicly viewable statuses","args":[{"name":"lookup_status","description":"Raw field for status of property","template":"lookup.html"},{"name":"list_str_statuses","description":"A list of statuses that are publicly viewable","template":"list_str.html"}]},{"name":"show_address","description":"Takes a raw field for whether to show the address and a mapping of the possible raw values to either 'Y' or 'G'","args":[{"name":"lookup_field","description":"Raw field for whether to show the address","template":"lookup.html"},{"name":"hash_show_address","description":"A mapping of possible raw values to 'Y' or 'G'","template":"hash.html"}]},{"name":"fetch_or_notify","description":"Takes a raw field for status, a mappings of raw statuses to our statuses and a default value to return if raw gives us a value not in the mapping","args":[{"name":"lookup_status","description":"Raw field for status of property","template":"lookup.html"},{"name":"hash_statuses","description":"A mapping of raw statuses to our statuses","template":"hash.html"},{"name":"str_default","description":"The default status if we cant find the rest statuses in the mapping","template":"str.html"}]}];
      raw_data_columns = ["A","B","C","D"];
      target_columns = [{"name":1,"persisted_func":"[\"acres_to_sq_feet\", \"B\"]"},{"name":2,"persisted_func":"[\"fetch_or_notify\", \"B\", {\"FOO\": \"A\"}, \"A\"]"},{"name":3},{"name":4},{"name":5},{"name":6}];
    </script>
  </head>
  <body ng-app='exampleApp'>
    <div ng-controller='ExampleController'>
      <script id='lookup.html' type='text/ng-template'>
        <select class='form-control' ng-model='arg.value' ng-options='raw_column as raw_column for raw_column in raw_data_columns'></select>
      </script>
      <script id='str.html' type='text/ng-template'>
        <input class='form-control' ng-model='arg.value'>
      </script>
      <script id='hash.html' type='text/ng-template'>
        <div ng-init='arg.keys = arg.keys || [""]'></div>
        <div ng-init='arg.values = arg.values || [""]'></div>
        <div class='form-inline text-center' ng-repeat='key in arg.keys track by $index'>
          <input class='form-control' ng-change='remove_blanks_from_hash(arg)' ng-model='arg.keys[$index]' style='width: 45%'>
          <span>
            :
          </span>
          <input class='form-control' ng-model='arg.values[$index]' style='width: 45%'>
        </div>
      </script>
      <script id='list_str.html' type='text/ng-template'>
        <div ng-init="arg.values = arg.keys || ['']"></div>
        <div ng-repeat='val in arg.values track by $index'>
          <input class='form-control' ng-change='arg.values = remove_blanks(arg.values)' ng-model='arg.values[$index]'>
        </div>
      </script>
      <script id='list_lookup.html' type='text/ng-template'>
        <select class='form-control' multiple='true' ng-model='arg.values' ng-options='raw_column as raw_column for raw_column in raw_data_columns'></select>
      </script>
      <div class='container'>
        <div ng-repeat='column in target_columns'>
          <div class='row'>
            <div class='col-md-1'>
              {{column.name}}
            </div>
            <div class='col-md-1'>
              <button class='btn' ng-click='column_to_edit = (column_to_edit === column ? nil : column)'>
                edit
              </button>
            </div>
            <div class='col-md-10'>
              <input class='form-control' readonly value='{{column.selected_func || column.persisted_func}}'>
            </div>
          </div>
          <div class='row'>
            <div class='col-md-offset-2 col-md-10' ng-if='column_to_edit===column'>
              <json_func_builder column='{{column}}'></json_func_builder>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
